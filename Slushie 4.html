<!DOCTYPE html>
<html lang="en">
<head>
  <meta chapset="UTF-8">
  <title>Slushies | Save while drinking</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Basic Reset */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: Arial, sans-serif; line-height: 1.6; font-size: 18px;}
    header { background: #3498db; color: white; padding: 1rem; text-align: center; }
    header h1 { font-size: 2rem; }
    header p { font-size: 1rem; }
    nav { background: #2980b9; padding: 0.5rem; text-align: center; }
    nav button { margin: 0 0.5rem; padding: 0.5rem 1rem; color: white; background: transparent; border: 1px solid white; cursor: pointer; }
    section { display: none; padding: 1rem;  }
    section.active { display: block; }
    form { margin: 1rem 0; }
    #orderForm{background-color: wheat;}
    label { display: block; margin-top: 0.5rem; font-weight: bold; }
    input, select, textarea { width: 100%; padding: 0.5rem; margin-top: 0.3rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    table, th, td { border: 1px solid #ddd; }
    th, td { padding: 0.5rem; text-align: left; }
    .product-list, .cart-list { margin-top: 1rem; }
    .product-item, .cart-item { border: 1px solid #ccc; padding: 0.5rem; margin-bottom: 0.5rem; }
    .btn { padding: 0.5rem 1rem; background: #27ae60; color: white; border: none; cursor: pointer; }
    .btn.red { background: #c0392b; }
    .flex { display: flex; align-items: center; gap: 0.5rem; }
    /* Modal for Banking Details */
    .modal {
      display: none;
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      justify-content: center; align-items: center;
    }
    .modal-content {
      background: white; padding: 1rem; width: 90%; max-width: 400px; border-radius: 5px;
    }
    tr, td{
        border: 2px solid wheat;
    }
    table{align-items: center;width: 100%;}
    #column1{width: 40%;}
    #column2{width: 35%;}
    #column3{width: 25%;}
    .btnQty{padding-right: 5px; padding-left: 5px; text-align: center; font-weight: 500;}
    footer { 
        text-align: center; 
        margin-top: 2rem; 
        font-size: 0.8rem; 
        cursor: pointer; 
        background-color: teal;
        padding: 10px;
        font-size: 16px;

    }
    footer a{
        text-decoration: none;
        color: black;
        background-color: teal;

    }
    @media (min-width: 600px) {
      .flex { display: flex; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Slushies</h1>
    <p>Save while drinking</p>
  </header>
  <nav>
    <button onclick="showSection('orderForm')">Order Form</button>
    <button href="Index.html">Contact Us</button>
  </nav>

  <!-- Order Form Section (Default) -->
  <section id="orderForm" class="active">
    <h2>Place Your Order</h2>
    <div id="customerProducts" class="product-list">
      <!-- Products will be loaded dynamically -->
    </div>
    <div id="customerCart" class="cart-list">
      <fieldset>
        <legend><h3>Your Cart</h3></legend>
      <div id="cartItems"></div>
      <p><strong>Total Due: R <span id="totalDue">0</span></strong></p>
      </fieldset>
    </div>
    <form id="customerDetails">
      <label for="surname">Surname</label>
      <input type="text" id="surname" required>
      <label for="initial">Initial</label>
      <input type="text" id="initial" required>
      <label for="gender">Gender</label>
      <select id="gender">
        <option value="Male">Male</option>
        <option value="Female">Female</option>
      </select>
      <label for="paymentType">Payment Type</label>
      <select id="paymentType" onchange="toggleBankModal()">
        <option value="Cash">Cash</option>
        <option value="Card">Card</option>
      </select><br><br>
      <button type="button" class="btn" onclick="placeOrder()">Place Order</button>
    </form>
  </section>

  <!-- Modal for Banking Details (Card payment) -->
  <div id="bankModal" class="modal">
    <div class="modal-content">
      <h3>Banking Details</h3>
      <p><strong>Bank Name:</strong> AdminBank</p>
      <p><strong>Name & Initials:</strong> Admin User</p>
      <p><strong>Account Number:</strong> 1234567890</p>
      <p><strong>Cell Number:</strong> 0123456789</p>
      <button class="btn" onclick="copyBankDetails()">Copy Details</button>
      <button class="btn red" onclick="closeBankModal()">Close</button>
    </div>
  </div>

  <!-- Admin Login Section -->
  <section id="adminLogin">
    <h2>Admin Login</h2>
    <form onsubmit="adminLogin(event)">
      <label for="adminUsername">Username</label>
      <input type="text" id="adminUsername" required>
      <label for="adminPassword">Password</label>
      <input type="password" id="adminPassword" required><br><br>
      <button type="submit" class="btn">Login</button>
    </form>
  </section>

  <!-- Admin Panel Section -->
  <section id="adminPanel">
    <h2>Admin Panel</h2>
    <button class="btn" onclick="showSection('adminOrders')">View Orders</button>
    <h3>Manage Products</h3>
    <form id="productForm" onsubmit="addOrUpdateProduct(event)">
      <input type="hidden" id="editIndex" value="-1">
      <label for="productName">Product Name</label>
      <input type="text" id="productName" required>
      <label for="productPrice">Price (Rands)</label>
      <input type="number" id="productPrice" required>
      <label for="productQty">Quantity</label>
      <input type="number" id="productQty" required>
      <label for="productPic">Picture URL</label>
      <input type="text" id="productPic" accept="image/*" required><br><br>
      <button type="submit" class="btn">Save Product</button>
    </form>
    <div id="adminProducts" class="product-list">
      <!-- List of products with update/delete options -->
    </div>
  </section>

  <!-- Admin Orders Section -->
  <section id="adminOrders">
    <h2>Orders Record</h2>
    <div id="ordersList">
      <!-- Orders will be shown here -->
    </div>
    <button class="btn" onclick="downloadOrders()">Download Orders</button>
    <button class="btn red" onclick="showSection('adminPanel')">Back to Admin Panel</button>
  </section>

  <footer>
    <a onclick="showSection('adminLogin')">&copy;</a> Slushies 2025. All rights reserved.
  </footer>

  <script>
    // Global arrays
    let products = [];
    let orders = [];
    let cart = [];
    let orderCount = 1; // starts from 1
    // Simulate order number reset daily.
    const today = new Date().toLocaleDateString();
    let lastReset = localStorage.getItem('lastReset') || today;
    if (lastReset !== today) {
      orderCount = 1;
      localStorage.setItem('lastReset', today);
    }

    // Utility to show specific sections
    function showSection(id) {
      document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      if(id === 'orderForm') loadCustomerProducts();
      if(id === 'adminPanel') renderAdminProducts();
      if(id === 'adminOrders') renderOrders();
    }

    // Admin Login simulation
    function adminLogin(e) {
      e.preventDefault();
      const username = document.getElementById('adminUsername').value;
      const password = document.getElementById('adminPassword').value;
      if(username === 'admin' && password === 'admin') {
        showSection('adminPanel');
      } else {
        alert('Invalid credentials');
      }
    }

    // Add or Update product function
    function addOrUpdateProduct(e) {
      e.preventDefault();
      const name = document.getElementById('productName').value;
      const price = parseFloat(document.getElementById('productPrice').value);
      const qty = parseInt(document.getElementById('productQty').value);
      const pic = document.getElementById('productPic').value;
      const editIndex = parseInt(document.getElementById('editIndex').value);
      const productData = { name, price, qty, pic };
      
      if(editIndex >= 0) {
       
        products[editIndex] = productData;
      } else {
        products.push(productData);
      }
      
      document.getElementById('productForm').reset();
      document.getElementById('editIndex').value = -1;
      renderAdminProducts();
    }

    // Render Admin's product list with update and delete buttons
    function renderAdminProducts() {
      const container = document.getElementById('adminProducts');
      container.innerHTML = "";
      products.forEach((prod, index) => {
        const div = document.createElement('div');
        div.className = "product-item";
        div.innerHTML = `<strong>${prod.name}</strong> - R${prod.price} - Qty: ${prod.qty}
          <div class="flex">
            <button class="btn" onclick="editProduct(${index})">Edit</button>
            <button class="btn red" onclick="deleteProduct(${index})">Delete</button>
          </div>`;
        container.appendChild(div);
      });
    }

    function editProduct(index) {
      const prod = products[index];
      document.getElementById('productName').value = prod.name;
      document.getElementById('productPrice').value = prod.price;
      document.getElementById('productQty').value = prod.qty;
      document.getElementById('productPic').value = prod.pic;
      document.getElementById('editIndex').value = index;
    }

    function deleteProduct(index) {
      if(confirm("Are you sure to delete this product?")){
        products.splice(index, 1);
        renderAdminProducts();
      }
    }

    // Customer side: load and display products
    function loadCustomerProducts() {
      const container = document.getElementById('customerProducts');
      container.innerHTML = "";
      if(products.length === 0) {
        container.innerHTML = "<p>No products available</p>";
        return;
      }
      products.forEach((prod, index) => {
        const div = document.createElement('div');
        div.className = "product-item";
        div.innerHTML = `<table><tr><td id="column1"><img src="${prod.pic}" alt="${prod.name}" width="100"></td>
                         <td id="column2"><p><strong>${prod.name}</strong></p>
                         <p>Price: R${prod.price}</p></td>
                         <td id="column3"><button class="btn" onclick="addToCart(${index})">Add to Cart</button></td></tr></table>`;
        container.appendChild(div);
      });
    }

    function addToCart(index) {
      const prod = products[index];
      // Check if product already in cart
      const existing = cart.find(item => item.index === index);
      if(existing) {
        existing.quantity += 1;
      } else {
        cart.push({index, quantity: 1});
      }
      renderCart();
    }

    function renderCart() {
      const container = document.getElementById('cartItems');
      container.innerHTML = "";
      let total = 0;
      cart.forEach((item, idx) => {
        const prod = products[item.index];
        const itemTotal = prod.price * item.quantity;
        total += itemTotal;
        const div = document.createElement('div');
        div.className = "cart-item";
        div.innerHTML = `<table><tr><td><strong>${prod.name}</strong> - R${prod.price}</td>  
                         <td><button class="btnQty" onclick="changeQuantity(${idx}, -1)">-</button>
                         ${item.quantity} 
                         <button class="btnQty" onclick="changeQuantity(${idx}, 1)">+</button></td>
                         <td style="width:30%;"> R${itemTotal.toFixed(2)}</td></tr></table>`;
        container.appendChild(div);
      });
      document.getElementById('totalDue').textContent = total.toFixed(2);
    }

    function changeQuantity(cartIndex, delta) {
      cart[cartIndex].quantity += delta;
      if(cart[cartIndex].quantity <= 0) cart.splice(cartIndex,1);
      renderCart();
    }

    // Place Order function
    function placeOrder() {
      if(cart.length === 0) { alert("Cart is empty."); return; }
      const surname = document.getElementById('surname').value;
      const initial = document.getElementById('initial').value;
      const gender = document.getElementById('gender').value;
      const paymentType = document.getElementById('paymentType').value;
      // If payment type is Card, ensure banking modal is acknowledged.
      if(paymentType === "Card") {
        if(confirm("Please confirm your banking details from the modal. Proceed?")===false) return;
      }
      const totalDue = document.getElementById('totalDue').textContent;
      const orderNumber = (orderCount < 10 ? "0" : "") + orderCount;
      orderCount++;
      const dateTime = new Date().toLocaleString();
      const orderProducts = cart.map(item => {
        const p = products[item.index];
        return `${p.name} (x${item.quantity})`;
      }).join(", ");
      const orderData = {
        orderNumber, dateTime, customer: {surname, initial, gender, paymentType},
        products: orderProducts,
        totalDue
      };
      orders.push(orderData);
      // Simulate sending order info to WhatsApp by creating a link
      const whatsappMsg = encodeURIComponent(
        `New Order \nOrder No: ${orderNumber}\nDate: ${dateTime}\nCustomer: ${surname} ${initial}, ${gender}\nPayment: ${paymentType}\nProducts: ${orderProducts}\nTotal Due: R${totalDue}`
      );
      window.open(`https://wa.me/27633479940?text=${whatsappMsg}`, '_blank');
      alert("Order placed successfully!");
      cart = [];
      renderCart();
      document.getElementById('customerDetails').reset();
   
    }

    // Render Orders for Admin
    function renderOrders() {
      // Sort orders by orderNumber ascending
      const sorted = orders.sort((a,b)=> Number(a.orderNumber) - Number(b.orderNumber));
      const container = document.getElementById('ordersList');
      container.innerHTML = "";
      if(sorted.length === 0) {
        container.innerHTML = "<p>No orders yet.</p>";
        return;
      }
      sorted.forEach(order => {
        const div = document.createElement('div');
        div.style.border = "1px solid #ccc";
        div.style.margin = "0.5rem 0";
        div.style.padding = "0.5rem";
        div.innerHTML = `<p><strong>Order No:</strong> ${order.orderNumber}</p>
                         <p><strong>Date/Time:</strong> ${order.dateTime}</p>
                         <p><strong>Customer:</strong> ${order.customer.surname} ${order.customer.initial} (${order.customer.gender})</p>
                         <p><strong>Payment:</strong> ${order.customer.paymentType}</p>
                         <p><strong>Products:</strong> ${order.products}</p>
                         <p><strong>Total Due:</strong> R${order.totalDue}</p>`;
        container.appendChild(div);
      });
    }

    // Download orders as text file
    function downloadOrders() {
      let text = "";
      orders.forEach(order => {
        text += `Order No: ${order.orderNumber}\nDate/Time: ${order.dateTime}\nCustomer: ${order.customer.surname} ${order.customer.initial}, ${order.customer.gender}\nPayment: ${order.customer.paymentType}\nProducts: ${order.products}\nTotal Due: R${order.totalDue}\n-----------------\n`;
      });
      const blob = new Blob([text], {type: "text/plain"});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = "orders.txt";
      a.click();
    }

    // Banking details modal functions
    function toggleBankModal() {
      const paymentType = document.getElementById('paymentType').value;
      if(paymentType === "Card") {
        document.getElementById('bankModal').style.display = "flex";
      } else {
        closeBankModal();
      }
    }
    function closeBankModal() {
      document.getElementById('bankModal').style.display = "none";
    }
    function copyBankDetails() {
      const details = "Bank Name: AdminBank\nName & Initials: Admin User\nAccount Number: 1234567890\nCell Number: 0123456789";
      navigator.clipboard.writeText(details).then(() => {
        alert("Banking details copied");
      });
    }
  </script>
</body>
</html>
